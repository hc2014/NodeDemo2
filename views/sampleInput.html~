<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>样本登陆</title>
    <script src="/js/jquery-1.7.2.js"></script>
    <script src="/js/jquery.jqGrid.min.js"></script>
    
    <script src="/js/tool.js"></script>
    <script src="/js/jquery-ui-1.11.2.custom/jquery-ui.min.js"></script>
    <script src="/js/My97DatePicker/WdatePicker.js"></script>
    <!--<link href="/js/jquery-ui-1.11.2.custom/jquery-ui.css" rel="stylesheet" />-->
    <link href="/css/ui.jqgrid.css" rel="stylesheet" />
     <link href="/css/jquery-ui.css" rel="stylesheet" />
    <script type="text/javascript">

        $(function () {
            $("#right").width($(window).width() - 220);
            $("#right").height($(window).height() - 90);
            bindSelect({ url: '/views/sampleInput.html?type=businessType', data: {}, sourceID: 'drp_ywlx', value: 'ORIGREC', text: 'BUSTYPE', isdefault: false });
            bindSelect({ url: '/views/sampleInput.html?type=getKS', data: {}, sourceID: 'drp_ks', value: 'VALUE', text: 'TEXT', isdefault: true });
            bindSelect({ url: '/views/sampleInput.html?type=getDoctor', data: {}, sourceID: 'drp_doctor', value: 'VALUE', text: 'TEXT', isdefault: true });
            bindSelect({ url: '/views/sampleInput.html?type=getBasicType', data: {}, sourceID: 'drp_basictype', value: 'VALUE', text: 'TEXT', isdefault: true });
            $("#drp_basictype").on("change", function () {

                $("#drp_basictypeinfo").html("");
                
            	bindSelect({
                    url: '/views/sampleInput.html?type=getBasicTypeInfo', data: { fiter: escape($(this).find("option:selected").text()) },
                    sourceID: 'drp_basictypeinfo', value: 'DESCRIPTION', text: 'DESCRIPTION'
                });
            })
            
            
            $('#Grid').jqGrid({
                url: '/views/sampleInput.html?type=getSampleList',
                datatype: 'json',
                width: 200,
                mtype: "get",
                height: parseInt($(window).height() - 90),
                rowNum: 999,
                rownumbers: true,
                shrinkToFit: false,
                colModel: [
                 { name: 'BARCODE', index: 'BARCODE', label: '样品标签', width: 100, align: 'left' },
                 { name: 'FULLNAME', index: 'FULLNAME', label: '录入人', width: 60, align: 'left' },
                  { name: 'ORIGREC', index: 'ORIGREC', label: 'ORIGREC', width: 60, align: 'left' ,hidden:true}
                ],
                onSelectRow:function(id){
                		var barcode=$("#Grid").jqGrid('getRowData',id).BARCODE;
                		var origrec=$("#Grid").jqGrid('getRowData',id).ORIGREC;
                		console.log(origrec);
                			//$('#Grid1').jqGrid('setGridParam', { url: '/views/sampleInput.html?type=123',page: 1 }).trigger('reloadGrid');
                	
                		$.ajax({
                			 url: '/views/sampleInput.html',
                			type:"get",
                			data:{type:"getOneSample",barcode:barcode},
                			success:function(data){
                					var  sample=eval(data)[0];
                					$("#txt_sjdw").val(sample.SAMPLEFROM).attr("disabled","disabled");
                					$("#txt_sqdh").val(sample.BARCODE);
                					$("#drp_ywgs").find("option:contains('"+sample.SAMPLETO+"')").attr("selected",true);
                					$("#drp_ywlx").find("option:contains('"+sample.BUSSINESSTYPE+"')").attr("selected",true);
                					var cyrq=new Date(sample.COLLECTDDATE).Format("yyyy-MM-dd")
                					var sjrq=new Date(sample.SENDDATE).Format("yyyy-MM-dd")
                					var jssj=new Date(sample.COLLECTDDATE).Format("hh:mm:ss")
                					$("#txt_cyrq").val(cyrq);
                					$("#txt_sjrq").val(sjrq);
                					$("#txt_jssj").val(jssj).attr("disabled","disabled");
                					
                			}                		
                		});
                },
                loadComplete:function(data){
                		$("#Grid").setSelection(1);        
                },
                xmlReader: {
                    root: 'Items',
                    row: 'Item',
                    page: 'page',
                    total: 'total',
                    repeatitems: false,
                    records: 'records'
                }
                });

            $('#Grid1').jqGrid({ 
                 url: '/views/sampleInput.html?type=getSampleGroupList&origrec=28999569',
                datatype: 'json',
                width: 650,
                mtype: "get",
                height: 350,
                rowNum: 999,
                rownumbers: true,
                shrinkToFit: false,
                colModel: [
                 { name: 'id', index: 'id', label: '检测项目', width: 200, align: 'left' },
                 { name: 'age', index: 'age', label: '项目类型', width: 100, align: 'right' },
                { name: 'age', index: 'age', label: '要求报告时间', width: 100, align: 'right' },
                { name: 'age', index: 'age', label: '签约价格', width: 80, align: 'right' },
                { name: 'age', index: 'age', label: '检测单位', width: 60, align: 'right' }, 
                { name: 'age', index: 'age', label: '测试名称', width: 100, align: 'right' }
                ],
                 loadComplete:function(data){
                		console.log(data);
                },
                xmlReader: {
                    root: 'Items',
                    row: 'Item',
                    page: 'page',
                    total: 'total',
                    repeatitems: false,
                    records: 'records'
                }
            });
            $("#tabs").tabs();
			$("#txt_sjdw").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "/views/sampleInput.html",
                        type:"get",
                        datetype: "json",
                        data: { type: "getSJDW" ,q:$("#txt_sjdw").val(),max:50},
                        success: function (data) {

                            response($.map(eval('(' + data + ')'), function (item) {
                                return { 
                                    label: "[" + item.SHORTNAME + "]" + item.COMPNAME,
                                    value: item.RASCLIENTID
                                }
                            }));
                        }
                    })
                },
                minLength: 1
            });
 
            $("#txt_barcode").on("blur",function(){
            	      $.ajax({
            	      	url:"/views/sampleInput.html",
            	      	type:"get",
            	      	data:{type:"CheckBarCode",barcode:$(this).val()},
            	      	success:function(data){
            	      			alert(data);
            	      	}
            	      });
            })
            
            $("#txt_sjdw").on("blur",function(){
            	      $.ajax({
            	      	url:"/views/sampleInput.html",
            	      	type:"get",
            	      	data:{type:"CheckSJDW",q:$(this).val()},
            	      	success:function(data){
            	      			if(data<1){
            	      				alert("送检单位不对!");
            	      				$("#txt_sjdw").val("");
            	      				$("#txt_sjdw").focus();updateSJDW
            	      			}else{
            	      				$("#txt_jssj").focus();    
            	      				updateSJDW();          	    		      	      			
            	      			}
            	      	}
            	      });
            })
            
            
            $("#lb_sjdw").on("dblclick",function(){
            		$("#txt_sjdw").val("").removeAttr("disabled");            
            })
            
            
            $("#lb_jssj").on("dblclick",function(){
            		$("#txt_jssj").val("").removeAttr("disabled");            
            })
            
            $("#txt_jssj").on("blur",function(){
            	    if($(this).val()==""){
            	    		alert("接收时间不对!");
            	    		$("#txt_jssj").focus();            	    
            	    }else{
            	    		//这里主要是修改  接收时间,
            	    		$.ajax({
            	    		url:"/views/sampleInput.html",
            	    		data:{type:"updateJSSJ",barcode:$("#txt_sqdh").val(),jssj:$("#txt_jssj").val()},
            	    		type:"get",
            	    		success:function(data){
            	    			alert(data);
            	    		}
            	    		})
            	    }
            })
            
            
        });
        
        function updateSJDW(){
                $.ajax({
	      	    		url:"/views/sampleInput.html",
	      	    		data:{type:"updateSJDW",barcode:$("#txt_sqdh").val(),sjdw:$("#txt_sjdw").val()},
	      	    		type:"get",
	      	    		success:function(data){
	      	    			alert(data);
	      	    		}
      	    		})  
        }
    </script>
    <style>
        .red
        {
            color: red;
        }

        .col1
        {
            text-align: right;
            width: 80px;
        }txt_sqdh
        
        
    </style>
</head>
<body>
    <div id="top" style="width: 98%; height: 30px; padding: 5px">
        <label class="red">申请单号:</label><input type="text" id="txt_barcode" style="width: 100px;" />
       <input type="button" id="import" value="文件导入"></input>
        <span style="margin-left: 100px">样本个数<input type="text" style="width: 50px" />
            样本管数<input type="text" style="width: 50px" />
            提交总数<input type="text" style="width: 50px" />
        </span>
        <span style="float: right; margin-right: 30px">
            <a href="#" id="a_checked">提交选中</a>
            <a href="#" id="a_all">提交所有</a>
            <a href="#" id="a_copy">复制</a>
            <a href="#" id="a_del">删除</a>
            <a href="#" id="a_special">特殊样本</a>
        </span>
    </div>
    <div id="left" style="float: left; ">
        <table id="Grid">
        </table>
    </div>
    <div id="right" style="float: right;">
        <fieldset style="height: 100%">
            <legend>基本信息</legend>
            <div id="main_left" style="float: left; width: 400px; height: 98%; border: 1px solid gray;">
                <table>
                    <tr>
                        <td class="red col1"><label id="lb_sjdw">送检单位:</label></td>
                        <td>
                            <input id="txt_sjdw" type="text" style="width: 180px" /></td>
                    </tr>
                    <tr>
                        <td class="red col1">申请单号:</td>
                        <td>
                            <input id="txt_sqdh" type="text" style="width: 180px; " disabled="disabled" /></td>
                    </tr>
                    <tr>
                        <td class="red col1">业务归属:</td>
                        <td>
                            <select id="drp_ywgs" style="width: 180px">disabled="disabled"
                            		<option>杭州迪安</option>
                                <option>合作单位</option>
                            </select></td>
                    </tr>
                    <tr>
                        <td class="red col1">业务类型:</td>
                        <td>
                            <select id="drp_ywlx" style="width: 180px"></select></td>
                    </tr>
                    <tr>
                        <td class="col1">采样日期:</td>
                        <td>
                            <input id="txt_cyrq" type="date" style="width: 120px" value="2014-10-29" />
                            <label id="lb_jssj" class="red">接收时间</label><input id="txt_jssj"   type="time" style="width: 100px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">病人姓名:</td>	
                        <td>
                            <input type="text" style="width: 150px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">性别:</td>
                        <td>
                            <select style="width: 50px">
                                <option>男</option>
                                <option>女</option>
                            </select>年龄<input type="text" style="width: 50px" />
                            <select style="width: 80px">
                                <option>岁</option>
                                <option>月</option>
                                <option>天</option>
                            </select></td>
                    </tr>
                    <tr>
                        <td class="col1">病人类别:</td>
                        <td>
                            <select style="width: 100px">
                                <option>门诊</option>
                                <option>住院</option>
                                <option>体检</option>

                            </select>电话<input type="tel" style="width: 120px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">门/住院号:</td>
                        <td>
                            <input type="text" style="width: 200px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">科室:</td>
                        <td>
                            <select id="drp_ks" style="width: 120px"></select>床号<input type="text" style="width: 80px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">临床诊断:</td>
                        <td>
                            <input type="text" style="width: 180px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">送检医生:</td>
                        <td>
                            <select id="drp_doctor" style="width: 120px"></select>电话<input type="tel" style="width: 80px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">送检日期:</td>
                        <td>
                            <input id="txt_sjrq" type="date" style="width: 120px" value="2014-10-29" /><label>采样时间</label><input type="time" style="width: 80px" /></td>
                    </tr>
                    <tr>
                        <td class="col1">报告方式:</td>
                        <td>
                            <input type="text" style="width: 180px" />
                            <button>?</button></td>
                    </tr>
                    <tr>
                        <td class="col1">基本状态:</td>
                        <td>
                            <select id="drp_basictype" style="width: 120px"></select><select id="drp_basictypeinfo" style="width: 120px"></select></td>
                    </tr>
                    <tr>
                        <td class="col1">个数:</td>
                        <td>
                            <input type="number" style="width: 80px;" /><input type="number" style="width: 120px;" /></td>
                    </tr>
                    <tr>
                        <td class="col1">备注:</td>
                        <td>
                            <textarea rows="5" style="width: 180px; resize: none"></textarea>
                            <input type="checkbox" />加急</td>
                    </tr>
                </table>
            </div>
            <div id="main_right1" style="float: right; width: 645px; height: 200px;">
                <div style="width: 300px; height: 180px; float: left;">
                    助记符<input type="text" style="width: 120px;" />
                    <button>查找</button>
                    <textarea style="width: 300px; height: 160px; resize: none"></textarea>
                </div>

              <div style="width: 320px; margin-right: 10px; height: 180px; float: right;" id="tabs">
                    <ul>
                        <li><a href="#tabs-1">常用测试</a></li>
                        <li><a href="#tabs-2">客户套餐</a></li>
                        <li><a href="#tabs-3">签约套餐</a></li>
                    </ul>
                    <div id="tabs-1" >
                        <p>123123</p>
                    </div>
                    <div id="tabs-2">
                        <p>wersf</p>
                    </div>
                    <div id="tabs-3">
                        <p>dddddddddddd</p>
                    </div>
                </div>

            </div>
            <div id="main_right2" style="float: right; margin-top: 10px; width: 645px; height: 350px;">
                <table id="Grid1">
                </table>
            </div>
        </fieldset>
    </div>
</body>
</html>
